apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "hortator.fullname" . }}-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "hortator.labels" . | nindent 4 }}
data:
  # Flat keys read directly by the operator controller
  presidioEnabled: {{ .Values.presidio.enabled | quote }}
  presidioEndpoint: {{ if .Values.presidio.enabled }}"http://{{ include "hortator.fullname" . }}-presidio.{{ .Release.Namespace }}.svc:3000"{{ else }}""{{ end }}
  warmPoolEnabled: {{ .Values.warmPool.enabled | quote }}
  warmPoolSize: {{ .Values.warmPool.size | quote }}
  # Agent defaults â€” the operator reads this at startup to configure
  # reconciliation behavior and default values for AgentTask Pods.
  config.yaml: |
    agent:
      image: {{ .Values.agent.image | quote }}
      timeout: {{ .Values.agent.timeout | quote }}
      defaultTimeoutSeconds: {{ .Values.agent.defaultTimeoutSeconds }}
      resources:
        requests:
          cpu: {{ .Values.agent.resources.requests.cpu | quote }}
          memory: {{ .Values.agent.resources.requests.memory | quote }}
        limits:
          cpu: {{ .Values.agent.resources.limits.cpu | quote }}
          memory: {{ .Values.agent.resources.limits.memory | quote }}

    models:
      default:
        endpoint: {{ .Values.models.default.endpoint | quote }}
        name: {{ .Values.models.default.name | quote }}
      presets:
        ollama:
          enabled: {{ .Values.models.presets.ollama.enabled }}
          endpoint: {{ .Values.models.presets.ollama.endpoint | quote }}
        vllm:
          enabled: {{ .Values.models.presets.vllm.enabled }}
          endpoint: {{ .Values.models.presets.vllm.endpoint | quote }}
        litellm:
          enabled: {{ .Values.models.presets.litellm.enabled }}
          endpoint: {{ .Values.models.presets.litellm.endpoint | quote }}

    budget:
      enabled: {{ .Values.budget.enabled }}
      priceSource: {{ .Values.budget.priceSource | quote }}
      fallbackBehavior: {{ .Values.budget.fallbackBehavior | quote }}
      defaultLimit:
        maxCostUsd: {{ .Values.budget.defaultLimit.maxCostUsd | quote }}

    health:
      enabled: {{ .Values.health.enabled }}
      checkIntervalSeconds: {{ .Values.health.checkIntervalSeconds }}
      stuckDetection:
        enabled: {{ .Values.health.stuckDetection.enabled }}

    storage:
      storageClass: {{ .Values.storage.storageClass | quote }}
      defaultSize: {{ .Values.storage.defaultSize | quote }}

    presidio:
      enabled: {{ .Values.presidio.enabled }}
      image: {{ .Values.presidio.image | quote }}
      scoreThreshold: {{ .Values.presidio.scoreThreshold }}
      action: {{ .Values.presidio.action | quote }}
      model: {{ .Values.presidio.model | quote }}

    telemetry:
      enabled: {{ .Values.telemetry.enabled }}

    runtime:
      filesystem:
        enforceRequired: {{ .Values.runtime.filesystem.enforceRequired }}
      contextManagement:
        strategy: {{ .Values.runtime.contextManagement.strategy | quote }}
