# Contributing to Hortator

Thank you for your interest in contributing to Hortator!

## Development Setup

1. Fork and clone the repository
2. Install dependencies:
   - Go 1.25+
   - kubectl
   - kubebuilder
   - A Kubernetes cluster (kind, minikube, etc.)
   - golangci-lint (for linting)

3. Install CRDs:
   ```bash
   make sync-crds              # Ensure CRDs are up to date
   kubectl apply -f crds/
   ```

4. Run the operator locally:
   ```bash
   go run cmd/main.go
   ```

5. Run tests:
   ```bash
   go test ./...
   ```

## Project Structure

```
api/v1alpha1/          # CRD Go types (AgentTask, AgentPolicy)
config/crd/bases/      # Generated CRD YAMLs (controller-gen output â€” do not edit)
crds/                  # Aggregated CRDs: generated + hand-written (single source of truth)
charts/hortator/       # Helm chart (crds/ mirrored into charts/hortator/crds/)
cmd/
  main.go              # Operator entrypoint
  gateway/main.go      # OpenAI-compatible API gateway
  hortator/            # CLI (for use inside agent pods)
internal/
  controller/          # Reconciler, pod builder, policy, warm pool, result cache, metrics
  gateway/             # HTTP handlers, types, helpers
sdk/
  python/              # Python SDK (hortator package)
  typescript/          # TypeScript SDK (@hortator/sdk)
docs/                  # Documentation
```

## CRD Workflow

CRDs are maintained with a single-source-of-truth workflow to avoid drift:

| Source | Contents |
|--------|----------|
| `config/crd/bases/` | Generated by controller-gen from Go types in `api/v1alpha1/` |
| `crds/` | Aggregated CRDs: generated copies + hand-written (`agentrole.yaml`) |
| `charts/hortator/crds/` | Mirror of `crds/` for Helm installs |

**After changing Go types** (`api/v1alpha1/*_types.go`):
```bash
make sync-crds    # Regenerates CRDs and syncs to crds/ + charts/hortator/crds/
```

**After editing hand-written CRDs** (`crds/agentrole.yaml`):
```bash
make sync-crds    # Copies to charts/hortator/crds/
```

**To verify everything is in sync:**
```bash
make verify-crds  # Fails if any location is out of sync
```

CI runs `make sync-crds && git diff --exit-code` on every PR to catch forgotten syncs.

> **Never edit** files in `config/crd/bases/` or `charts/hortator/crds/` directly. Edit Go types or `crds/agentrole.yaml`, then run `make sync-crds`.

## Making Changes

1. Create a feature branch
2. Make your changes
3. Run tests: `go test ./...`
4. Run linter: `golangci-lint run`
5. If CRDs changed: `make sync-crds`
6. Update documentation in `docs/` if behavior changed
7. Submit a pull request

## Commit Style

Use [conventional commits](https://www.conventionalcommits.org/):

```
type(scope): description
```

Types: `feat`, `fix`, `improvement`, `build`, `ci`, `chore`, `docs`, `perf`, `refactor`, `revert`, `style`, `test`

## Code Style

- Follow standard Go conventions
- Run `gofmt` and `goimports`
- Add tests for new functionality
- Update documentation as needed
- All Go source files must include the MIT license header (see `hack/boilerplate.go.txt`):
  ```go
  /*
  Copyright (c) 2026 hortator-ai
  SPDX-License-Identifier: MIT
  */
  ```

## Pull Request Process

1. Update documentation if you changed behavior
2. Add tests for new features
3. Ensure all tests pass and linter is clean
4. Request review from maintainers

## License

By contributing, you agree that your contributions will be licensed under the MIT License.
